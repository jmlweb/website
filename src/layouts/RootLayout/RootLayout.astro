---
import Logo from '@/components/Logo.astro';
import ThemeToggler from './ThemeToggler.astro';
import { container } from '@/styles';

interface Props {
  title?: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang={Astro.currentLocale} class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="José Manuel Lucas | Frontend, TypeScript, CSS, Next.js" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title ?? 'José Manuel Lucas'}</title>
    <slot name="head" />
  </head>
  <body
    class="optimize-legibility min-h-screen overflow-y-auto overflow-x-hidden scroll-smooth bg-gradient-to-b from-slate-50 to-slate-100 font-sans text-slate-800/90 antialiased dark:from-slate-900 dark:to-slate-950 dark:text-slate-300/75"
  >
    <div class="grid min-h-screen grid-rows-[auto_1fr_auto]">
      <div class="border-b border-slate-300 dark:border-slate-800">
        <header
          class={container({
            class: 'flex items-center justify-between ~py-3/5',
          })}
        >
          <Logo color="reactive" />
          <ThemeToggler />
        </header>
      </div>
      <div class="flex flex-col">
        <slot />
      </div>
      <footer class="~py-6/8">
        <div class={container()}>
          <p>
            <span class="font-medium">José Manuel Lucas</span>
            <span class="text-slate-500">/ Murcia (España) / 2024</span>
          </p>
        </div>
      </footer>
    </div>
  </body>
</html>

<script is:inline>
  const isDarkMode =
    localStorage.getItem('theme') === 'dark' ||
    (!('theme' in localStorage) && !window.matchMedia('(prefers-color-scheme: light)').matches);
  document.documentElement.classList.toggle('dark', isDarkMode);
</script>

<script>
  import { isDarkAtom } from '@/store';

  const AnimationBlocker = () => {
    const css = document.createElement('style');
    css.appendChild(
      document.createTextNode(
        `* {
        -webkit-transition: none !important;
        -moz-transition: none !important;
        -o-transition: none !important;
        -ms-transition: none !important;
        transition: none !important;
      }`,
      ),
    );
    document.head.appendChild(css);
    window.getComputedStyle(css).opacity;
    return () => document.head.removeChild(css);
  };

  isDarkAtom.listen((isDark) => {
    const unblock = AnimationBlocker();
    document.documentElement.classList.toggle('dark', isDark);
    setTimeout(() => unblock(), 500);
  });

  window.addEventListener('storage', (e) => {
    if (e.key === 'theme') {
      isDarkAtom.set(e.newValue === 'dark');
    }
  });
</script>
